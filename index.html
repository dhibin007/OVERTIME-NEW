<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employee Hours App</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
header { background:#262e87; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; position:sticky; top:0; z-index:1001; }
#hamburgerBtn { font-size:24px; cursor:pointer; margin-right:10px; }
#sidebar { width:320px; background:#3a2b7c; color:white; position:fixed; top:0; left:-330px; height:100%; overflow:auto; transition:0.3s; padding:10px; z-index:1002; }
#sidebar.open { left:0; }
#overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); display:none; z-index:1001; }
button { cursor:pointer; margin:2px; padding:4px 8px; border:none; border-radius:4px; background:#f04e23; color:white; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #333; padding:6px; text-align:center; font-size:0.9em; }
th { background:#f7931e; color:white; }
input[type=time], input[type=text], input[type=date], select, #filterInput { width:90%; padding:4px; margin:2px 0; }
.employee-item { display:flex; align-items:center; justify-content:flex-start; padding:2px 4px; margin:2px 0; background:#f7931e; border-radius:4px; color:white; font-size:0.9em; }
.employee-item button { margin-right:5px; background:red; color:white; border:none; border-radius:3px; cursor:pointer; }
.collapsible { background:#262e87; color:white; cursor:pointer; padding:8px; width:100%; border:none; text-align:left; outline:none; font-size:0.9em; border-radius:3px; margin-top:5px; }
.active, .collapsible:hover { background:#3a2b7c; }
.content { display:none; overflow:hidden; padding-left:10px; }
#overtimeSummary { margin-top:10px; font-weight:bold; color:#262e87; }
@media(max-width:600px){
  table, th, td, input, select { font-size:0.8em; }
  header { flex-direction: column; align-items:flex-start; }
  #sidebar { width:260px; }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>
<body>

<header>
  <span id="hamburgerBtn">☰ Menu</span>
  <div style="display:flex; flex-wrap:wrap; gap:5px; margin-top:5px;">
    <input type="date" id="workDate">
    <button id="saveBtn">Save Data</button>
    <button id="exportCSVBtn">Export CSV</button>
    <button id="clearDataBtn">Clear Data</button>
    <input type="date" id="exportFrom" title="From Date">
    <input type="date" id="exportTo" title="To Date">
    <input type="text" id="filterInput" placeholder="Filter Employee Name">
    <button id="shareTeamCountBtn">Team Count</button>
    <button id="viewFilterBtn">View</button>
  </div>
  <div id="overtimeSummary">Total Overtime: 0 hrs</div>
</header>

<div id="overlay"></div>

<div id="sidebar">
  <button class="collapsible">Teams</button>
  <div class="content" id="teamsContent"></div>

  <button class="collapsible">Employee List</button>
  <div class="content">
    <ul id="masterList"></ul>
    <button onclick="addToMasterList()">➕ Add Master Employee</button>
  </div>

  <button class="collapsible">Site List</button>
  <div class="content">
    <ul id="masterSiteList"></ul>
    <button onclick="addToMasterSiteList()">➕ Add Site</button>
  </div>
</div>

<main style="margin-left:10px; padding:10px;">
  <table id="employeeTable"></table>
</main>

<script>
// ==========================
// Global Data
let teams = [
  { name:"Team 1", site:"", siteIn:"", siteOut:"", employees:[] },
  { name:"Team 2", site:"", siteIn:"", siteOut:"", employees:[] },
  { name:"Team 3", site:"", siteIn:"", siteOut:"", employees:[] },
  { name:"Team 4", site:"", siteIn:"", siteOut:"", employees:[] },
  { name:"OFF", site:"", siteIn:"", siteOut:"", employees:[] }
];
let masterEmployees = JSON.parse(localStorage.getItem("masterEmployees")) || [];
let masterSites = JSON.parse(localStorage.getItem("masterSites")) || [];
let allData = JSON.parse(localStorage.getItem("allData")) || {};
let selectedDate = new Date().toISOString().split("T")[0];

// ==========================
// Date Picker
const dateInput = document.getElementById("workDate");
dateInput.value = selectedDate;
dateInput.addEventListener("change", ()=>{
  selectedDate=dateInput.value;
  if(allData[selectedDate]){ teams=allData[selectedDate]; }
  else{ teams=[{name:"Team 1",site:"",siteIn:"",siteOut:"",employees:[]},
               {name:"Team 2",site:"",siteIn:"",siteOut:"",employees:[]},
               {name:"Team 3",site:"",siteIn:"",siteOut:"",employees:[]},
               {name:"Team 4",site:"",siteIn:"",siteOut:"",employees:[]},
               {name:"OFF",site:"",siteIn:"",siteOut:"",employees:[]}]; }
  buildTeamsContent(); buildEmployeeTable();
});

// ==========================
// Sidebar open/close
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
document.getElementById("hamburgerBtn").addEventListener("click", ()=>{
  sidebar.classList.add("open"); overlay.style.display="block";
});
overlay.addEventListener("click", ()=>{
  sidebar.classList.remove("open"); overlay.style.display="none";
});

// Collapsible
document.addEventListener("click", e=>{
  if(e.target.classList.contains("collapsible")){
    e.target.classList.toggle("active");
    let content = e.target.nextElementSibling;
    content.style.display = content.style.display==="block"?"none":"block";
  }
});

// ==========================
// Master Employee Functions
function addToMasterList(){
  const name = prompt("Enter employee name:"); if(!name) return;
  if(masterEmployees.includes(name)) return alert("Employee already exists");
  masterEmployees.push(name);
  localStorage.setItem("masterEmployees", JSON.stringify(masterEmployees));
  buildMasterList(); buildTeamsContent();
}
function buildMasterList(){
  const ul=document.getElementById("masterList"); ul.innerHTML="";
  masterEmployees.forEach(name=>{
    const li=document.createElement("li"); li.textContent=name;
    const del=document.createElement("button"); del.textContent="❌";
    del.onclick=()=>{ masterEmployees=masterEmployees.filter(e=>e!==name);
      localStorage.setItem("masterEmployees", JSON.stringify(masterEmployees));
      buildMasterList(); buildTeamsContent(); };
    li.prepend(del); ul.appendChild(li);
  });
}
buildMasterList();

// ==========================
// Master Site Functions
function addToMasterSiteList(){
  const name = prompt("Enter site name:"); if(!name) return;
  if(masterSites.includes(name)) return alert("Site already exists");
  masterSites.push(name);
  localStorage.setItem("masterSites", JSON.stringify(masterSites));
  buildMasterSiteList(); buildTeamsContent();
}
function buildMasterSiteList(){
  const ul=document.getElementById("masterSiteList"); ul.innerHTML="";
  masterSites.forEach(name=>{
    const li=document.createElement("li"); li.textContent=name;
    const del=document.createElement("button"); del.textContent="❌";
    del.onclick=()=>{ masterSites=masterSites.filter(e=>e!==name);
      localStorage.setItem("masterSites", JSON.stringify(masterSites));
      buildMasterSiteList(); buildTeamsContent(); };
    li.prepend(del); ul.appendChild(li);
  });
}
buildMasterSiteList();

// ==========================
// Teams Sidebar
function buildTeamsContent(){
  const menu=document.getElementById("teamsContent");
  menu.innerHTML="";
  teams.forEach(team=>{
    const teamDiv=document.createElement("div");
    const title=document.createElement("h4"); title.textContent=team.name; teamDiv.appendChild(title);

    if(team.name!=="OFF"){
      const siteSelect=document.createElement("select");
      siteSelect.innerHTML='<option value="">Select Site</option>';
      masterSites.forEach(siteName=>{
        const opt=document.createElement("option"); opt.value=siteName; opt.textContent=siteName;
        if(siteName===team.site) opt.selected=true;
        siteSelect.appendChild(opt);
      });
      const siteIn=document.createElement("input"); siteIn.type="time"; siteIn.value=team.siteIn;
      const siteOut=document.createElement("input"); siteOut.type="time"; siteOut.value=team.siteOut;
      const applyBtn=document.createElement("button"); applyBtn.textContent="Apply to Team";
      applyBtn.onclick=()=>{
        team.site=siteSelect.value; team.siteIn=siteIn.value; team.siteOut=siteOut.value;
        allData[selectedDate]=teams;
        localStorage.setItem("allData", JSON.stringify(allData));
        buildEmployeeTable();
      };
      teamDiv.appendChild(siteSelect); teamDiv.appendChild(siteIn); teamDiv.appendChild(siteOut); teamDiv.appendChild(applyBtn);
    }

    const ul=document.createElement("ul"); ul.dataset.team=team.name;
    team.employees.forEach(emp=>{
      const li=document.createElement("li"); li.className="employee-item";
      const del=document.createElement("button"); del.textContent="❌";
      del.onclick=()=>{ team.employees=team.employees.filter(e=>e.id!==emp.id); buildTeamsContent(); buildEmployeeTable(); };
      li.appendChild(del); li.appendChild(document.createTextNode(emp.name));
      li.dataset.empId=emp.id; ul.appendChild(li);
    });

    const addSelect=document.createElement("select");
    addSelect.innerHTML='<option value="">Select Employee</option>';
    masterEmployees.forEach(e=>{ addSelect.innerHTML+=`<option value="${e}">${e}</option>`; });
    const addBtn=document.createElement("button"); addBtn.textContent="➕ Add Employee";
    addBtn.onclick=()=>{ if(!addSelect.value) return;
      team.employees.push({id:Date.now(), name:addSelect.value});
      allData[selectedDate]=teams;
      localStorage.setItem("allData", JSON.stringify(allData));
      buildTeamsContent(); buildEmployeeTable();
    };
    teamDiv.appendChild(addSelect); teamDiv.appendChild(addBtn);

    new Sortable(ul,{group:"employees", animation:150, onEnd:evt=>{
      const empId=evt.item.dataset.empId;
      const newTeamName=evt.to.dataset.team;
      moveEmployeeToTeam(empId,newTeamName);
    }});

    teamDiv.appendChild(ul); menu.appendChild(teamDiv);
  });
}

function moveEmployeeToTeam(empId,newTeamName){
  let emp, oldTeam;
  teams.forEach(t=>t.employees.forEach(e=>{ if(e.id==empId){ emp=e; oldTeam=t; } }));
  if(emp && oldTeam.name!==newTeamName){
    oldTeam.employees=oldTeam.employees.filter(e=>e.id!=empId);
    teams.find(t=>t.name===newTeamName).employees.push(emp);
    allData[selectedDate]=teams;
    localStorage.setItem("allData", JSON.stringify(allData));
    buildTeamsContent(); buildEmployeeTable();
  }
}

// ==========================
// Employee Table
function buildEmployeeTable(){
  const table=document.getElementById("employeeTable");
  table.innerHTML=`<tr><th>Name</th><th>Date</th><th>Site</th><th>In</th><th>Out</th></tr>`;
  if(!allData[selectedDate]) return;
  teams.forEach(team=>team.employees.forEach(emp=>{
    const row=table.insertRow();
    row.insertCell(0).textContent=emp.name;
    row.insertCell(1).textContent=selectedDate;
    row.insertCell(2).textContent=team.site||"";
    row.insertCell(3).textContent=team.siteIn||"";
    row.insertCell(4).textContent=team.siteOut||"";
  }));
}

// ==========================
// Save Data
document.getElementById("saveBtn").addEventListener("click", ()=>{
  allData[selectedDate]=teams;
  localStorage.setItem("allData", JSON.stringify(allData));
  alert("Saved for "+selectedDate);
});

// ==========================
buildTeamsContent(); buildEmployeeTable();
</script>
</body>
</html>
